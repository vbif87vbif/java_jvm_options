# Опции JVM

Опции деляться на стандартные (standard), не стандартные (non-standard) и продвинутые (advanced).
Не стандартные имеют префекс -X. Продвинутые имеют префикс -XX.

1. Для того чтобы посмотреть с какими опциями запущена виртальная машина на клонах unix систем выполните команду
ps -ef | grep java

2. Для получения стандартных опции выполните команду
java -h

> Обратите внимание на опцию "-D"  вы будете часто ей пользоваться для передачи прикладных параметров (специфичные  для логики вашего приложения). В самом примитивном приложении без фреймворков вы можете их читать из System.getProperty(). https://howtodoinjava.com/java/basics/java-system-properties/

3. Для получения не стандартных опции выполните команду
java -X  -version

> Обратите внимание на предупреждение
The -X options are non-standard and subject to change without notice.

4. Наиболее интересны среди не стандартных опции
-Xms - задает начальный размер Java heap size
-Xmx - задает максимальный размер Java heap size
-Xss - задает размер java thread stack size

> Замечания по размеру для -Xmx:
32-битная виртуальная машина может адресовать 4G памяти, но дополнительные ограничения накладывает еще операционная система
Microsoft Windows (старые версии) ~1.5 GB
Linux ~2.5 - 3.0 GB для новых ядер и ~2 GB на старых
Solaris ~3.3 GB

5. Мониторим окружение в котором заупскается приложение
-XshowSettings выводи на консоль много полезной информации об окружении в котором стартует виртуальная машина. Помогает выявлять проблемы настройки окружения целевой системы.
-Xloggc:<file> наблюдение за сборщиком мусора (not for prod)

6. Для получения продвинутых опции выполните команду (могут очень сильно отличаться между версиями виртуальной машины)
java -XX:+PrintFlagsFinal -version

7. Из интересных стоит отметить
-XX:PermSize    до 8 java была такая область памяти под пула строк (String pool) и метаданных классов (class metadata),но начиная с 8 была заменеа на Metaspace и параметер стал не актуален

8. Для анализа работы сборщика мусора
-verbose:gc - логирует работу сборщика
-XX:+PrintGCDetails - тоже что и преъдидущий, но еще информацию про new generation (одна из областей в heap)
-XX:-PrintGCTimeStamps - добавляет еще тайминг
-XX:+HeapDumpOnOutOfMemoryError создаст файл с дампом в случаи потребления всей памяти и падения виртуальной машины. Можно ставить на проде
как альтернатива можно
-XX:HeapDumpPath= [path-to-heap-dump-directory]
-XX:+UseGCOverheadLimit
-XX:OnOutOfMemoryError="< cmd args >;< cmd args >"

9. Для мониторинга как наши классы загружаются и выгружаются
-XX:+TraceClassLoading
-XX:+TraceClassUnloading
